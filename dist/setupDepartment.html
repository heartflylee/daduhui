<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>部门设置</title>
    <!--公共-->
    <link type="image/x-icon" href="img/favicon.ico" rel="icon">

<link rel="stylesheet" href="css/reset.css">
<link rel="stylesheet" href="css/bootstrap.css">
<link rel="stylesheet" href="css/beAlert.css">
<link rel="stylesheet" href="css/select2.css">

<link rel="stylesheet" href="css/style.css">
<link rel="stylesheet" href="css/jqxgrid.css">


<script src="js/vue.min.js"></script>
<script src="js/vue-resource@1.3.4.js"></script>
<script src="js/jquery-1.10.2.min.js"></script>
<script src="js/bootstrap.js"></script>
<script src="js/jquery.autocomplete.js"></script>
<script src="js/resize.js"></script>
<script src="js/beAlert.js"></script>
<script src="js/select2.js"></script>
<script src="js/drag.js"></script>
<!--<script src="js/jsDate/laydate.js"></script>-->
<!--<script src="js/layDate/laydate.js"></script>-->
<!---->

<script src="js/audio.js"></script>

<!--[if lt IE 10]>
<script type="text/javascript" src="js/html5shiv.js"></script>
<script type="text/javascript" src="js/respond.min.js"></script>
<script type="text/javascript" src="js/placeholder.js"></script>
<![endif]-->
    <!--表格-->

    <script type="text/javascript" src="js/jqx/jqxcore.js"></script>
    <script type="text/javascript" src="js/jqx/jqxdata.js"></script>
    <script type="text/javascript" src="js/jqx/jqxbuttons.js"></script>
    <script type="text/javascript" src="js/jqx/jqxinput.js"></script>
    <script type="text/javascript" src="js/jqx/jqxscrollbar.js"></script>
    <script type="text/javascript" src="js/jqx/jqxmenu.js"></script>
    <script type="text/javascript" src="js/jqx/jqxgrid.js"></script>
    <script type="text/javascript" src="js/jqx/jqxgrid.sort.js"></script>
    <script type="text/javascript" src="js/jqx/jqxgrid.filter.js"></script>
    <script type="text/javascript" src="js/jqx/jqxgrid.selection.js"></script>
    <script type="text/javascript" src="js/jqx/jqxgrid.columnsresize.js"></script>
    <script type="text/javascript" src="js/jqx/jqxgrid.edit.js"></script>
    <script type="text/javascript" src="js/jqx/jqxgrid.pager.js"></script>
    <script type="text/javascript" src="js/jqx/jqxcheckbox.js"></script>
    <script type="text/javascript" src="js/jqx/jqxlistbox.js"></script>
    <script type="text/javascript" src="js/jqx/jqxcombobox.js"></script>
    <script type="text/javascript" src="js/jqx/jqxdropdownlist.js"></script>
    <script type="text/javascript" src="js/jqx/jqxgrid.columnsreorder.js"></script>

    <script src="js/jqx/jqxcalendar.js"></script>
    <script src="js/jqx/jqxdatetimeinput.js"></script>
    <script src="js/jqx/globalize.js"></script>

    <script src="js/jqx/globalize.culture.ch-CN.js"></script>


</head>

<body>
    <!-- Preloader -->
    <div class="preloader">
        <div class="cssload-speeding-wheel"></div>
    </div>
    <div id="app">
        <!--header-->
        <setup-head></setup-head>
        <section class="b-main">
            <!--左侧菜单-->
            <menu-aside menu="index"></menu-aside>
            <div class="b-panel">
                <customer-head @layer="layer"></customer-head>
                <customer-table></customer-table>
            </div>
        </section>


    </div>

    <template id="inputRow">
    <div class="m-row">
        <div class="m-name " :class="{required:rows.required}">
            {{rows.name}}
        </div>
        <div class="m-info m-input" v-if="rows.input">
            <input type="text" class="input" :placeholder="rows.placeholder == undefined ? '请输入'+rows.name:rows.placeholder" v-model="rows.value"/>
            <div v-if="rows.enter" class="enter-btn" :class="rows.icon"><i></i>{{rows.text}}</div>
        </div>
        <div class="m-info" v-else>
            {{rows.value}}
        </div>
    </div>
</template>
<script>
    var inputRow = Vue.extend({
        template: '#inputRow',
        props: ['rows']
    });
//    Vue.component('inputRow',inputRow);
</script>
    <!--左侧导航-->
    <template id="aside">
    <!-- 左侧菜单 -->
    <aside class="b-aside">
        <div class="menu-wrap">
            <ul class="m-list">
                <menu-content :content="index" index="1"></menu-content>
                <menu-content :content="customer" index="2"></menu-content>
                <menu-content :content="task" index="3"></menu-content>
            </ul>
        </div>
    </aside>
</template>
<script>
    var menuContent = Vue.extend({
        template: '<li class="m-nav menu-list" :class=" \'nav-left\' + index" v-if="content.subShow">\n' +
            '    <a class="nav-info" href="javascript:void(0)">\n' +
            '        <i class="icon m-icon" :class="content.icon" ></i>\n' +
            '        <label>{{content.title}}</label>\n' +
            '        <i v-if="content.sub.length>0" class="icon-sign"></i>\n' +
            '    </a>\n' +
            '    <ul class="m-second-list child-list" v-if="content.sub.length>0" >\n' +
            '        <li class="m-second" v-for="sub in content.sub">\n' +
            '            <a :href="sub.href">\n' +
            '                <i></i>\n' +
            '                <label>{{sub.title}}</label>\n' +
            '            </a>\n' +
            '        </li>\n' +
            '    </ul>\n' +
            '</li>' +
            '<li class="m-nav " v-else>\n' +
            '    <a class=\'nav-info\' :href="content.href">\n' +
            '        <i class="icon m-icon" :class="content.icon"></i>\n' +
            '        <label>{{content.title}}</label>\n' +
            '        <i class="icon-sign"></i>\n' +
            '    </a>\n' +
            '</li>',
        props: ['content', 'index']
    });

    var aside = Vue.extend({
        template: '#aside',
        data: function () {
            return {
                index: {
                    title: "首页",
                    icon: "icon-m1",
                    subShow: true,
                    active: "",
                    sub: []
                },
                customer: {
                    title: "客户",
                    icon: "icon-m2",
                    subShow: true,
                    active: "",
                    sub: [
                        {
                            title: "客户列表",
                            href: "customer.html"
                        },
                        {
                            title: "企业公海",
                            href: "contact.html"
                        }
                    ]
                },
                task: {
                    title: "任务",
                    icon: "icon-m3",
                    href: "",
                    subShow: true,
                    active: "",
                    sub: [{
                        title: "电话任务",
                        href: "task.html"
                    }, {
                        title: "短信任务",
                        href: "taskMessage.html"
                    }, {
                        title: "邮件任务",
                        href: "taskEmail.html"
                    }]
                }
            }
        },
        methods: {
            // menu: function () {
            //     $("body").toggleClass('side-open');
            //     tableResize();
            // }
        },
        components: {
            'menuContent': menuContent
        }
    });
    Vue.component('menuAside', aside);
</script>
    <!--顶部-->
    <template id="setupHead">
    <header class="b-header setupHead-wrap">
        <div class="h-right">
            <div class="h-nav-box">
                <div class="nav-li">
                    <a class="nav-href" href="javascript:void(0);">
                        <i class="nav-icon nav-home"></i>
                        返回首页
                    </a>
                </div>
                <div class="nav-li">
                    <a class="nav-href" href="javascript:void(0);">
                        <i class="nav-icon nav-logout"></i>
                        退出登录
                    </a>
                </div>
            </div>
        </div>
        <div class="h-main">
            <div class="h-company">
                <div class="head-photo" :style="'background-image:url('+ user.headImg +');'"></div>
                <div class="head-company">{{user.company}}</div>
            </div>
        </div>
    </header>
</template>
<script>
    var setupHead = Vue.extend({
        template: '#setupHead',
        data: function () {
            return {
                user: {
                    company: "北京蜜宝世纪科技有限公司",
                    headImg: "img/head.png"
                }
            }
        },
        methods: {
            //头部搜索
            Hsearch: function () {

            }
        }
    });
    Vue.component('setupHead', setupHead);
</script>
    <!--弹框-->
    <template id="layer">
    <div class="modal" v-if="layer.show">
        <div class="layer-bg"></div>
        <div class="modal-dialog">
            <div class="modal-content">
                <form @submit.prevent="submit" autocomplete="off">
                    <div class="modal-header layer-head">
                        <button type="button" class="close" @click="close">&times;</button>
                        <h4 class="modal-title">{{layer.title}}</h4>
                    </div>
                    <div class="modal-body" :style="{maxHeight:maxHeight+'px'}">
                        <slot></slot>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" @click="close">关闭</button>
                        <input type="submit" class="btn btn-primary" v-if="layer.submit" value="提交" />
                    </div>
                </form>
            </div>
        </div>
    </div>
</template>
<script>
    var layer = Vue.extend({
        template: '#layer',
        props: ['layer'],
        data: function () {
            return {
                maxHeight: document.body.clientHeight - 200
            }
        },
        methods: {
            close: function (layer) {
                console.log(this.$props);
                this.$props.layer.show = false;
                return false;
            },
            submit: function () {
                console.log("彈框提交");
                console.log(vm.$refs[this.$props.layer.layerName]);
                vm.$refs[this.$props.layer.layerName].submit();
                return false;
            }
        },
        mounted: function () {
            var _self = this;
            window.onresize = function () {
                _self.maxHeight = document.body.clientHeight - 200;
            }
        },
        watch: {
            maxHeight: function (val) {
                var modalBody = document.getElementsByClassName('modal-body');
                for (var i = 0; i < modalBody.length; i++) {
                    modalBody[i].style.maxHeight = val + 'px';
                }
            }
        },
        updated: function () {
            var modalDialog = $(this.$el).find(".modal-dialog")[0];
            $(modalDialog).css({
                top: ($("body").height() - $(modalDialog).height()) / 2,
                left: ($("body").width() - $(modalDialog).width()) / 2
            });
            $(modalDialog).bg_move({
                    move: '.modal-header',
                    closed: '.close'
                });
        }
    });

    Vue.component('layer', layer);
</script> <template id="autocomplete">
    <div class="autocomplete-wrap">
        <input type="text"
               :id="id"
               :class="classname"
               :name="name"
               :placeholder="placeholder"
               v-model="inputmodel"
               @input="input(inputmodel)"
               @blur="hideAll"
               @focus="focus"/>
        <div class="qixinbao" :class="business" @click="businessShow"><i></i>工商信息</div>
        <div v-if="showList" :class='"autocomplete autocomplete-"+ name ' :id="'autocomplete-'+ name ">
            <ul>
                <li v-for="data in json">
                    <a href="javascript:void(0)"
                       @click="selectList(data)">
                        <b>{{ data[anchor] }}</b>
                    </a>
                </li>
            </ul>
        </div>
    </div>
</template>

<script>
    var autocomplete = Vue.extend({
        template: '#autocomplete',
        props: {
            id: String,
            classname: String,
            name: String,
            placeholder: String,

            //父组件模型名称
            model: String,

            //JSON数据取值的Key
            anchor: {
                type: String,
                required: true
            },

            //请求的数据链接
            url: {
                type: String,
                required: true
            },

            //请求的参数KEY
            param: {
                type: String,
                default: 'q'
            },

            //拉取的数据个数的限制
            limit: {
                type: String,
                default: 5
            }
        },

        data: function () {
            return {
                showList: false,
                inputmodel: '',
                json: [],
                focusList: '',
                business:""
            }
        },

        methods: {
            input: function (val) {
                this.showList = true;
                console.log("输入");
                //触发调用getData方法
                this.getData(val);
                this.business="";
            },

            //隐藏补全列表
            hideAll: function (e) {
                var _self=this;
                //为了让blur方法延迟执行，以便能够成功执行click方法
                setTimeout(function () {
                    _self.showList = false;
                }, 250);
            },

            //
            focus: function (e) {
                this.focusList = 0;
            },

            //选中列表中的哪一项
            selectList: function (data) {
                console.log(data);
                console.log(JSON.stringify(data));

                //按照指定的JSON键值显示在模型上
                this.inputmodel = data.value;
                //传递给父组件中的对象
                this.showList = false;
                this.$emit('value',data);
                this.business="active";
            },

            //获取数据
            getData: function (val) {
                console.log(val);
                let self = this;

                if (this.url != null) {

                    let ajax = new XMLHttpRequest();

                    ajax.open('GET', `${this.url}?${this.param}=${val}`, true);
                    ajax.send();

                    ajax.addEventListener('progress', function (data) {
                        if (data.lengthComputable) {
                        }
                    });

                    ajax.addEventListener('loadend', function (data) {
                        console.log(data);
                        let json = JSON.parse(this.responseText);
                        console.log(json);
                        self.json = json;
                    });

                }
            },
            businessShow:function(){
                if(this.business ==""){
                    return false;
                }
                vm.$data.layers.business.show = true;

//                this.$emit('business',this.json);
            }

        }
    });
    Vue.component('autocomplete',autocomplete);

</script>

    <!--selected-->
    <template id="select2-template">
    <select>
        <option v-if="optiondefault == 'true'" selected value="0">请选择{{name}}</option>
        <slot></slot>
    </select>
</template>

<script>
    Vue.component('select2', {
        props: ['options', 'value','name','optiondefault'],
        template: '#select2-template',
        mounted: function () {
            var vm = this
            $(this.$el)
            // init select2
                .select2({ data: this.options })
                .val(this.value)
                .trigger('change')
                // emit event on change.
                .on('change', function () {
                    vm.$emit('input', this.value)
                })
        },
        watch: {
            value: function (value) {
                // update value
                $(this.$el).val(value).trigger('change');
            },
            options: function (options) {
                console.log(options);
                // update options
                $(this.$el).select2({ data: options })
            }
        },
        destroyed: function () {
            $(this.$el).off().select2('destroy')
        }
    })

</script>

    <script src="js/scripts.js"></script>
    <script src="js/setupDepartment.js"></script>

</body>

</html>