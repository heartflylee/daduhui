<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>外呼标签</title>
    <!--公共-->
    <link type="image/x-icon" href="img/favicon.ico" rel="icon">

<link rel="stylesheet" href="css/reset.css">
<link rel="stylesheet" href="css/bootstrap.css">
<link rel="stylesheet" href="css/beAlert.css">
<link rel="stylesheet" href="css/select2.css">

<link rel="stylesheet" href="css/style.css">
<link rel="stylesheet" href="css/jqxgrid.css">


<script src="js/vue.min.js"></script>
<script src="js/vue-resource@1.3.4.js"></script>
<script src="js/jquery-1.10.2.min.js"></script>
<script src="js/bootstrap.js"></script>
<script src="js/jquery.autocomplete.js"></script>
<script src="js/resize.js"></script>
<script src="js/beAlert.js"></script>
<script src="js/select2.js"></script>
<script src="js/drag.js"></script>
<!--<script src="js/jsDate/laydate.js"></script>-->
<!--<script src="js/layDate/laydate.js"></script>-->
<!---->

<script src="js/audio.js"></script>

<!--[if lt IE 10]>
<script type="text/javascript" src="js/html5shiv.js"></script>
<script type="text/javascript" src="js/respond.min.js"></script>
<script type="text/javascript" src="js/placeholder.js"></script>
<![endif]-->
    <!--表格-->

    <script type="text/javascript" src="js/jqx/jqxcore.js"></script>
    <script type="text/javascript" src="js/jqx/jqxdata.js"></script>
    <script type="text/javascript" src="js/jqx/jqxbuttons.js"></script>
    <script type="text/javascript" src="js/jqx/jqxinput.js"></script>
    <script type="text/javascript" src="js/jqx/jqxscrollbar.js"></script>
    <script type="text/javascript" src="js/jqx/jqxmenu.js"></script>
    <script type="text/javascript" src="js/jqx/jqxgrid.js"></script>
    <script type="text/javascript" src="js/jqx/jqxgrid.sort.js"></script>
    <script type="text/javascript" src="js/jqx/jqxgrid.filter.js"></script>
    <script type="text/javascript" src="js/jqx/jqxgrid.selection.js"></script>
    <script type="text/javascript" src="js/jqx/jqxgrid.columnsresize.js"></script>
    <script type="text/javascript" src="js/jqx/jqxgrid.edit.js"></script>
    <script type="text/javascript" src="js/jqx/jqxgrid.pager.js"></script>
    <script type="text/javascript" src="js/jqx/jqxcheckbox.js"></script>
    <script type="text/javascript" src="js/jqx/jqxlistbox.js"></script>
    <script type="text/javascript" src="js/jqx/jqxcombobox.js"></script>
    <script type="text/javascript" src="js/jqx/jqxdropdownlist.js"></script>
    <script type="text/javascript" src="js/jqx/jqxgrid.columnsreorder.js"></script>

    <script src="js/jqx/jqxcalendar.js"></script>
    <script src="js/jqx/jqxdatetimeinput.js"></script>
    <script src="js/jqx/globalize.js"></script>

    <script src="js/jqx/globalize.culture.ch-CN.js"></script>

    <link rel="stylesheet" href="css/zTreeStyle.css">
    <script src="js/jquery.ztree.core.js"></script>
    <script src="js/jquery.ztree.exedit.js"></script>

</head>

<body>
    <!-- Preloader -->
    <div class="preloader">
        <div class="cssload-speeding-wheel"></div>
    </div>
    <div id="app">
        <!--header-->
        <setup-head></setup-head>
        <section class="b-main">
            <!--左侧菜单-->
            <setup-aside menu="department"></setup-aside>
            <div class="b-panel">
                <div class="setup-title">
                    外呼标签
                    <div class="setupTable-right">
                        <div class="select-box">
                            <div class="select-text">
                                <b></b>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="setup-main">
                    <div class="setup-left department-left outbound">
                        <ztree editor="true" id="ztreeEditor" ref="ztreeEditor"></ztree>
                    </div>
                    <div class="setup-right">

                    </div>
                </div>
            </div>
        </section>

        <!-- <transition name="layer">
            <layer :layer="layers.departmentAdd">
                <department-add ref="departmentAdd" :message="layers.departmentAdd.message"></department-add>
            </layer>
        </transition> -->

    </div>



    <!-- <template id="setManager">
        <div class="layer-text-content">设置为管理员后该员工可看到本部门及下属部门的数据，是否继续</div>
    </template>
    <script>
        var setManager = Vue.extend({
            template: '#setManager',
            methods: {
                submit: function () {
                    console.log('设置为管理员');
                }
            }
        });
        Vue.component('setManager', setManager);
    </script> -->

    <!--左侧导航-->
    <template id="setupAside">
    <!-- 左侧菜单 -->
    <aside class="b-aside setupAside">
        <div class="menu-wrap">
            <ul class="m-list">
                <li class="setup-menu" v-for="item,$index in menuList">
                    <a :href="item.href" class="setup-menu-href" :class="menu == item.name?'active':''">
                        <i class="setup-icon" :class="'setup-m'+($index+1)"></i>
                        <span>{{item.text}}</span>
                    </a>
                </li>
            </ul>
        </div>
    </aside>
</template>
<script>

    var setupAside = Vue.extend({
        template: '#setupAside',
        props: ['menu'],
        data: function () {
            return {
                menuList: [
                    {
                        name: 'department',
                        icon: 'setup-m1',
                        text: '部门管理',
                        href: 'setupDepartment.html'
                    },
                    {
                        name: 'calltags',
                        icon: 'setup-m2',
                        text: '外呼标签',
                        href: 'outboundLabel.html'
                    },
                    {
                        name: 'message',
                        icon: 'setup-m3',
                        text: '短信设置',
                        href: 'javascript:void(0)'
                    },
                    {
                        name: 'email',
                        icon: 'setup-m4',
                        text: '邮件设置',
                        href: 'javascript:void(0)'
                    },
                    {
                        name: 'team',
                        icon: 'setup-m5',
                        text: '团队设置',
                        href: 'javascript:void(0)'
                    },
                    {
                        name: 'custom',
                        icon: 'setup-m6',
                        text: '自定义字段',
                        href: 'javascript:void(0)'
                    },

                ]
            }
        },
        methods: {
        }
    });
    Vue.component('setupAside', setupAside);
</script>
    <!--顶部-->
    <template id="setupHead">
    <header class="b-header setupHead-wrap">
        <div class="h-right">
            <div class="h-nav-box">
                <div class="nav-li">
                    <a class="nav-setup-href" href="javascript:void(0);">
                        <i class="nav-icon nav-home"></i>
                        <span>返回首页</span>
                    </a>
                </div>
                <div class="nav-li">
                    <a class="nav-setup-href" href="javascript:void(0);">
                        <i class="nav-icon nav-logout"></i>
                        <span>退出登录</span>
                    </a>
                </div>
            </div>
        </div>
        <div class="h-main">
            <div class="h-company">
                <div class="head-photo" :style="'background-image:url('+ user.headImg +');'"></div>
                <div class="head-company">{{user.company}}</div>
            </div>
        </div>
    </header>
</template>
<script>
    var setupHead = Vue.extend({
        template: '#setupHead',
        data: function () {
            return {
                user: {
                    company: "北京蜜宝世纪科技有限公司",
                    headImg: "img/head.png"
                }
            }
        },
        methods: {
            //头部搜索
            Hsearch: function () {

            }
        }
    });
    Vue.component('setupHead', setupHead);
</script>
    <!--弹框-->
    <template id="layer">
    <div class="modal" v-if="layer.show">
        <div class="layer-bg"></div>
        <div class="modal-dialog">
            <div class="modal-content">
                <form @submit.prevent="submit" autocomplete="off">
                    <div class="modal-header layer-head">
                        <button type="button" class="close" @click="close">&times;</button>
                        <h4 class="modal-title">{{layer.title}}</h4>
                    </div>
                    <div class="modal-body" :style="{maxHeight:maxHeight+'px'}">
                        <slot></slot>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" @click="close">关闭</button>
                        <input type="submit" class="btn btn-primary" v-if="layer.submit" value="提交" />
                    </div>
                </form>
            </div>
        </div>
    </div>
</template>
<script>
    var layer = Vue.extend({
        template: '#layer',
        props: ['layer'],
        data: function () {
            return {
                maxHeight: document.body.clientHeight - 200
            }
        },
        methods: {
            close: function (layer) {
                console.log(this.$props);
                this.$props.layer.show = false;
                return false;
            },
            submit: function () {
                console.log("彈框提交");
                console.log(vm.$refs[this.$props.layer.layerName]);
                vm.$refs[this.$props.layer.layerName].submit();
                return false;
            }
        },
        mounted: function () {
            var _self = this;
            window.onresize = function () {
                _self.maxHeight = document.body.clientHeight - 200;
            }
        },
        watch: {
            maxHeight: function (val) {
                var modalBody = document.getElementsByClassName('modal-body');
                for (var i = 0; i < modalBody.length; i++) {
                    modalBody[i].style.maxHeight = val + 'px';
                }
            }
        },
        updated: function () {
            var modalDialog = $(this.$el).find(".modal-dialog")[0];
            $(modalDialog).css({
                top: ($("body").height() - $(modalDialog).height()) / 2,
                left: ($("body").width() - $(modalDialog).width()) / 2
            });
            $(modalDialog).bg_move({
                    move: '.modal-header',
                    closed: '.close'
                });
        }
    });

    Vue.component('layer', layer);
</script>
    <!-- 树形图 -->
    <template id="ztree">
    <ul class="ztree" :id="id"></ul>
</template>
<script>

    var ztree = Vue.extend({
        template: '#ztree',
        props: ['editor', 'id'],
        data: function () {
            return {
                setting: {
                    view:
                        {
                            // showLine: false,
                            addHoverDom: addHoverDom,
                            removeHoverDom: removeHoverDom,
                            selectedMulti: false,
                            // showIcon: false,
                            fontCss: { 'font-weight': 'bold' }
                        },
                    check: {
                        enable: false
                    },
                    data: {
                        simpleData: {
                            enable: true
                        }
                    },
                    edit: {
                        enable: true,
                        showRemoveBtn: showRemoveBtn,
                        removeTitle: "删除",
                        renameTitle: "编辑"
                    },
                    callback: {
                        beforeEditName: beforeEditName,
                        beforeRemove: beforeRemove,
                        onMouseDown: onMouseDown
                    }
                },
                departSetting: {
                    view: {
                        selectedMulti: false,
                        // showIcon: false,
                        fontCss: {
                            "font-weight": "bold"
                        }
                    },
                    check: {
                        enable: false
                    },
                    data: {
                        simpleData: {
                            enable: true
                        }
                    },
                    edit: {
                        enable: false
                    },
                    callback: {
                        onClick: departSelect
                    },
                    async: {
                        enable: true
                    }

                },
                zNodes: [
                    {
                        name: "全公司", open: true,
                        children: [
                            {
                                name: "销售部",
                                children: [
                                    { name: "销售部1" },
                                    { name: "销售部2" },
                                    { name: "销售部3" },
                                    { name: "销售部4" }
                                ]
                            },
                            {
                                name: "市场部",
                                children: [
                                    { name: "市场部1" },
                                    { name: "市场部2" },
                                    { name: "市场部3" },
                                    { name: "市场部4市场部4市场部4市场部4市场部4" }
                                ]
                            }
                        ]
                    }
                ]
            }
        },
        mounted() {
            var _self = this;
            console.log((_self.$props.editor == 'true'));
            console.log((_self.$props.id));
            if (_self.$props.editor == 'true') {
                $.fn.zTree.init($("#" + _self.$props.id), _self.$data.setting, _self.$data.zNodes);
            } else {
                $.fn.zTree.init($("#" + _self.$props.id), _self.$data.departSetting, _self.$data.zNodes);
            }
        }
    });
    Vue.component('ztree', ztree);
    //显示添加节点
    function addHoverDom(treeId, treeNode) {
        var sObj = $("#" + treeNode.tId + "_span");
        if (treeNode.editNameFlag || $("#addBtn_" + treeNode.tId).length > 0) return;
        var addStr = "<span class='button add' id='addBtn_" + treeNode.tId
            + "' title='添加' onfocus='this.blur();'></span>";
        sObj.after(addStr);
        var btn = $("#addBtn_" + treeNode.tId);
        if (btn) btn.bind("click", function () {
            newDepart();
            return false;
        });
    };

    //去除添加节点
    function removeHoverDom(treeId, treeNode) {
        $("#addBtn_" + treeNode.tId).unbind().remove();
    }

    //删除节点（根节点不显示删除）
    function showRemoveBtn(treeId, treeNode) {
        return !(treeNode.parentTId == null);
    }

    //编辑前设置
    function beforeEditName(treeId, treeNode) {
        var zTree = $.fn.zTree.getZTreeObj(vm.$refs.ztreeEditor.$props.id);
        zTree.selectNode(treeNode);
        vm.$data.layers.departmentModify.show = true;
        return false;
    }


    //删除
    function beforeRemove(treeId, treeNode) {
        var zTree = $.fn.zTree.getZTreeObj(vm.$refs.ztreeEditor.$props.id);
        zTree.selectNode(treeNode);
        return confirm("确认删除  " + treeNode.name + " 吗？");
    }

    //选择部门
    function onMouseDown(event, treeId, treeNode) {
        //选中部门
    }

    //变更中选择部门
    function departSelect(event, treeId, treeNode) {
        if (treeNode != null) {
            vm.$refs.selectDepart.$data.depart = treeNode.name;
            vm.$refs.selectDepart.$data.departShow = false;
            // $("#department").val(treeNode.name);
            var zTree = $.fn.zTree.getZTreeObj(vm.$refs.selectDepart.$refs.departZtree.$props.id);
            zTree.selectNode(treeNode);
            // $("#departTree-wrap").hide();
        }
    }
    //新建部门
    function newDepart() {
        vm.$data.layers.departmentAdd.show = true;
    }
</script>

    <script src="js/scripts.js"></script>
    <script src="js/outboundLabel.js"></script>

</body>

</html>