<template id="ztree">
    <ul class="ztree" :id="id"></ul>
</template>
<script>

    var ztree = Vue.extend({
        template: '#ztree',
        props: ['editor', 'id'],
        data: function () {
            return {
                setting: {
                    view:
                        {
                            // showLine: false,
                            addHoverDom: addHoverDom,
                            removeHoverDom: removeHoverDom,
                            selectedMulti: false,
                            // showIcon: false,
                            fontCss: { 'font-weight': 'bold' }
                        },
                    check: {
                        enable: false
                    },
                    data: {
                        simpleData: {
                            enable: true
                        }
                    },
                    edit: {
                        enable: true,
                        showRemoveBtn: showRemoveBtn,
                        removeTitle: "删除",
                        renameTitle: "编辑"
                    },
                    callback: {
                        beforeEditName: beforeEditName,
                        beforeRemove: beforeRemove,
                        onMouseDown: onMouseDown
                    }
                },
                departSetting: {
                    view: {
                        selectedMulti: false,
                        // showIcon: false,
                        fontCss: {
                            "font-weight": "bold"
                        }
                    },
                    check: {
                        enable: false
                    },
                    data: {
                        simpleData: {
                            enable: true
                        }
                    },
                    edit: {
                        enable: false
                    },
                    callback: {
                        onClick: departSelect
                    },
                    async: {
                        enable: true
                    }

                },
                zNodes: [
                    {
                        name: "全公司", open: true,
                        children: [
                            {
                                name: "销售部",
                                children: [
                                    { name: "销售部1" },
                                    { name: "销售部2" },
                                    { name: "销售部3" },
                                    { name: "销售部4" }
                                ]
                            },
                            {
                                name: "市场部",
                                children: [
                                    { name: "市场部1" },
                                    { name: "市场部2" },
                                    { name: "市场部3" },
                                    { name: "市场部4市场部4市场部4市场部4市场部4" }
                                ]
                            }
                        ]
                    }
                ]
            }
        },
        mounted() {
            var _self = this;
            console.log((_self.$props.editor == 'true'));
            console.log((_self.$props.id));
            if (_self.$props.editor == 'true') {
                $.fn.zTree.init($("#" + _self.$props.id), _self.$data.setting, _self.$data.zNodes);
            } else {
                $.fn.zTree.init($("#" + _self.$props.id), _self.$data.departSetting, _self.$data.zNodes);
            }
        }
    });
    Vue.component('ztree', ztree);
    //显示添加节点
    function addHoverDom(treeId, treeNode) {
        var sObj = $("#" + treeNode.tId + "_span");
        if (treeNode.editNameFlag || $("#addBtn_" + treeNode.tId).length > 0) return;
        var addStr = "<span class='button add' id='addBtn_" + treeNode.tId
            + "' title='添加' onfocus='this.blur();'></span>";
        sObj.after(addStr);
        var btn = $("#addBtn_" + treeNode.tId);
        if (btn) btn.bind("click", function () {
            newDepart();
            return false;
        });
    };

    //去除添加节点
    function removeHoverDom(treeId, treeNode) {
        $("#addBtn_" + treeNode.tId).unbind().remove();
    }

    //删除节点（根节点不显示删除）
    function showRemoveBtn(treeId, treeNode) {
        return !(treeNode.parentTId == null);
    }

    //编辑前设置
    function beforeEditName(treeId, treeNode) {
        var zTree = $.fn.zTree.getZTreeObj(vm.$refs.ztreeEditor.$props.id);
        zTree.selectNode(treeNode);
        vm.$data.layers.departmentModify.show = true;
        return false;
    }


    //删除
    function beforeRemove(treeId, treeNode) {
        var zTree = $.fn.zTree.getZTreeObj(vm.$refs.ztreeEditor.$props.id);
        zTree.selectNode(treeNode);
        return confirm("确认删除  " + treeNode.name + " 吗？");
    }

    //选择部门
    function onMouseDown(event, treeId, treeNode) {
        //选中部门
    }

    //变更中选择部门
    function departSelect(event, treeId, treeNode) {
        if (treeNode != null) {
            vm.$refs.selectDepart.$data.depart = treeNode.name;
            vm.$refs.selectDepart.$data.departShow = false;
            // $("#department").val(treeNode.name);
            var zTree = $.fn.zTree.getZTreeObj(vm.$refs.selectDepart.$refs.departZtree.$props.id);
            zTree.selectNode(treeNode);
            // $("#departTree-wrap").hide();
        }
    }
    //新建部门
    function newDepart() {
        vm.$data.layers.departmentAdd.show = true;
    }
</script>